{# templates/admin/image_search.html.twig #}
{% extends '@SyliusAdmin/layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .image-search-results {
            display: flex;
            flex-wrap: wrap;
            gap: 1em;
            margin-top: 1em;
        }
        .image-item {
            flex: 0 0 auto;
            text-align: center;
        }
        .image-wrapper {
            position: relative;
            display: inline-block;
        }
        .image-wrapper img {
            max-height: 300px;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .image-info {
            position: absolute;
            bottom: 0;
            left: 0; right: 0;
            background: rgba(0,0,0,0.7);
            color: #fff;
            padding: 0.5em;
            font-size: 0.85em;
            line-height: 1.2;
            opacity: 0;
            transition: opacity .2s ease-in-out;
            box-sizing: border-box;
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
        }
        .image-wrapper:hover .image-info {
            opacity: 1;
        }
        .download-btn {
            margin-top: .5em;
        }
    </style>
{% endblock %}

{% block content %}
  <div class="ui segment">
    <h1 class="ui header">Recherche d’images</h1>
    <form class="ui form" method="get" action="{{ path('admin_image_search') }}">
      <div class="field">
        <input
          type="text" name="q"
          placeholder="Ex : iPhone 11 noir 64G"
          value="{{ query|e }}"
        >
      </div>
      <button class="ui primary button" type="submit">Rechercher</button>
    </form>
  </div>

  {% if query is not empty %}
    <h3 class="ui dividing header">Résultats pour “{{ query|e }}”</h3>

    {% if images is empty %}
      <p>Aucune image trouvée.</p>
    {% else %}
      <div class="image-search-results">
        {% for img in images %}
          <div class="image-item">
            <div class="image-wrapper">
              <img src="{{ img.url }}" alt="" />
              <div class="image-info">
                <strong>{{ img.title|e }}</strong><br>
                {{ img.snippet|e }}
              </div>
            </div>
            <div class="download-btn">
              <a
                href="{{ path('admin_download_image', { url: img.url }) }}"
                class="ui button mini"
              >
                Télécharger
              </a>
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="ui pagination menu" style="margin-top: 1em;">
        {% if page > 1 %}
          <a class="item"
             href="{{ path('admin_image_search', { q: query, page: page-1 }) }}">
            « Précédent
          </a>
        {% endif %}
        <span class="item disabled">
          Page {{ page }} sur {{ pages }}
        </span>
        {% if page < pages %}
          <a class="item"
             href="{{ path('admin_image_search', { q: query, page: page+1 }) }}">
            Suivant »
          </a>
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
{% endblock %}
