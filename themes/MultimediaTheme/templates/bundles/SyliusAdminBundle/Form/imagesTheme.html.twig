{# templates/admin/_sylius_product_image_widget.html.twig #}
{% extends '@SyliusUi/Form/imagesTheme.html.twig' %}

{% block sylius_product_image_widget %}
    {{ block('sylius_image_widget') }}

    <div data-controller="image-search"
         data-image-search-product-id-value="{{ product.id }}"
         data-image-search-default-query-value="{{ product.name|e('html_attr') }}">
      {# — Boutons de recherche & collage #}
      
    </div>
      <button type="button"
              class="ui button primary"
              data-action="image-search#openModal">
        {{ 'Rechercher une image'|trans }}
      </button>
      <button type="button"
              class="ui button"
              data-action="image-search#pasteImage">
        {{ 'Coller une image' }}
      </button>

      {# — Modale pour la recherche Google #}
      <div class="ui modal"
           data-image-search-target="modal">
        <i class="close icon"
           data-action="image-search#closeModal"></i>
        <div class="header">{{ 'Rechercher une image'|trans }}</div>
        <div class="content">
          <div class="ui action input" style="width:100%;">
            <input type="text"
                   class="ui input fluid"
                   value="{{ product.name|e }}"
                   placeholder="{{ 'Votre recherche…'|trans }}"
                   data-image-search-target="query"
                   data-action="keydown->image-search#onKeydown">
            <button type="button" class="ui button primary"
                    data-action="image-search#search">
              {{ 'Rechercher'|trans }}
            </button>
          </div>
          <div class="ui divider"></div>
          <div class="ui five stackable cards"
               data-image-search-target="results">
            {# Insérées dynamiquement par Stimulus #}
          </div>
        </div>
        <div class="actions">
          <button type="button" class="ui button"
                  data-action="image-search#closeModal">
            {{ 'Fermer'|trans }}
          </button>
        </div>
      </div>

      {# — CONTENU pour le collage d’image — #}
     <div data-image-search-target="previewContainer"
       class="ui segment"
       style="display:none; margin-top:1em; max-width:300px;">
    <h4 class="ui header">{{ 'Aperçu de l’image collée' }}</h4>

    <img data-image-search-target="preview"
         alt="Preview"
         style="width:100%; border:1px solid #ddd; border-radius:4px;" />

    <p>{{ 'Taille :' }} <span data-image-search-target="size"></span></p>
    <button class="ui positive button"
            data-action="image-search#confirmPaste"
            data-image-search-target="confirmButton"
            disabled>
      {{ 'Valider l’image rognée' }}
    </button>
  </div>

    </div>

    {% apply spaceless %}
        {% if product.id is not null and product.variants|length > 0 and not product.simple %}
            <br/>
            {{ form_row(form.productVariants, {
                'remote_url': path('sylius_admin_ajax_product_variants_by_phrase', {'productCode': product.code}),
                'remote_criteria_type': 'contains',
                'remote_criteria_name': 'phrase',
                'load_edit_url': path('sylius_admin_ajax_product_variants_by_codes', {'productCode': product.code})
            }) }}
        {% endif %}
    {% endapply %}
{% endblock %}
